clc;clear;close all;
load FlowsAmong9.mat
load cateNode9.mat
load Series.mat
load predictResult.mat
load PredictFlows9.mat
%预测DC9附近的流量
nearFlows=Flows(:,365*2-61+1:365*2);

len_pre=31;%预测长度
%%
cate=1;
E{cate}=[45,73,91,96,147];
N{cate}=[47,72,52,11,8];
PredictFlows{cate}(1,:)=[6.720564292	6.750364351	6.787755432	6.824604972	6.874259554	6.92676845	6.983482725	7.046444495	7.11589741	7.192490409	7.276834718	7.369801731	7.472275214	7.585213675	7.70968678	7.846873063	7.998072149	8.164714795	8.348378306	8.550801286	8.773899843	9.01978579	9.290786629	9.58946761	9.918655995	10.28146782	10.68133741	11.12204984	11.60777684	12.14311619	12.73313534];
PredictFlows{cate}(2,:)=[126.6156971	127.1694549	127.8506703	128.641864	129.5417372	130.5259699	131.5980295	132.7854242	134.0945085	135.5370668	137.126652	138.8786206	140.809647	142.9378789	145.2834805	147.8686631	150.7179002	153.85816	157.3191663	161.1336815	165.3378129	169.9713561	175.0781714	180.706599	186.9099167	193.7468438	201.2820977	209.5870056	218.7401804	228.8282643	239.9467495];
PredictFlows{cate}(3,:)=[15.03060372	16.42972558	18.04940712	19.88026367	21.91918345	24.16979341	26.63158062	29.35171588	32.35016235	35.65464827	39.29638245	43.3100247	47.73376991	52.60932493	57.98286173	63.90525354	70.43256364	77.62657688	85.55538862	94.2940527	103.9252878	114.5402614	126.2394529	139.1336049	153.3447711	169.0074719	186.2699677	205.2956623	226.2646495	249.3754181	274.8467305];
PredictFlows{cate}(4,:)=[7.410355588	7.988085541	8.723357064	9.606604515	10.60682193	11.69769964	12.88496533	14.20124011	15.65246716	17.25143665	19.01336716	20.95531408	23.09574842	25.45476522	28.05472121	30.92023956	34.07844688	37.55923497	41.3955511	45.62371037	50.28373578	55.4197382	61.08033408	67.31910565	74.19510804	81.77342826	90.12580138	99.33128947	109.4770301	120.659061	132.9832293];
PredictFlows{cate}(5,:)=[7.288623793	7.998591988	8.79358095	9.688304077	10.67584466	11.77313661	12.97298506	14.29791641	15.75844158	17.36808842	19.14209617	21.09722405	23.25211719	25.62710174	28.24466463	31.12958601	34.30917499	37.81352928	41.67581937	45.93260544	50.6241815	55.79495717	61.49387808	67.77488921	74.69744553	82.32707473	90.73599753	100.0038113	110.2182436	121.4759824	133.8835914];

%%
cate=2;
E{cate}=[69,103];
N{cate}=[36,8];
PredictFlows{cate}(1,:)=[172.8342816	173.0705061	173.7769682	174.6527212	176.0177976	177.3759835	178.8053505	180.4177102	182.1982599	184.1604139	186.3193415	188.699483	191.3234129	194.2151655	197.4022148	200.9147807	204.7861523	209.0529464	213.7555468	218.9384734	224.6507869	230.9465589	237.8853834	245.5329425	253.9616265	263.25122	273.4896566	284.7738514	297.2106188	310.9176829	326.0247925];
PredictFlows{cate}(2,:)=[9.262395481	9.893003833	10.83304314	11.92709346	13.16969865	14.52392151	15.99721482	17.63205845	19.4337368	21.41898323	23.60654516	26.01762251	28.67514207	31.60403811	34.83208287	38.38984319	42.31099933	46.63266407	51.39574402	56.6453273	62.4311054	68.80784538	75.83590828	83.58182054	92.11890362	101.527968	111.8980783	123.3273961	135.9241094	149.8074564	165.1088543];
%%
cate=3;
s=[60,39,4,35,37,86,24,69];
for j=1:length(s)
    i=s(j);
edge=E{cate}(i);
Data=Time_var(edge,365*2-61+1:365*2);
Data=filloutliers(Data,"linear");
len=length(Data);
tmp_data=Data;
len_block=40;%滑块长度
for j=1:len_pre
   len=len+1;
   tmp_data(len)=Average(tmp_data,len_block);
end
PredictFlows{cate}(i,:)=tmp_data(len-len_pre+1:len);
clear len a b edge
end

%%
save("PredictFlows9.mat","PredictFlows");
clear ans

function y_pre=Average(y,n)
    m=length(y);
    y_pre=sum( y(m-n+1:m) ) / n;
end